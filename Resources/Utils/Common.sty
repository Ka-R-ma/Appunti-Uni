\ProvidesPackage{Common}

%% List of used packages
\usepackage[usernames, x11names]{xcolor}
\usepackage[explicit, compact]{titlesec}
\usepackage{fancyhdr}
\usepackage{nicefrac}
\usepackage[a4paper]{geometry}
%\usepackage{layout} %% The command \layout displays the document format
\usepackage[fixamsmath, allowspaces]{mathtools}
\usepackage{mathdots, mathrsfs, multicol}
\usepackage{amssymb, amsthm, amsmath}
\usepackage{tikz, pgfplots, circuitikz, caption, siunitx, forest}
\usepackage{listings, lstautogobble}
\usepackage{caption, subcaption, graphicx, wrapfig}
\usepackage[hidelinks]{hyperref}
\usepackage[italian]{babel}
\usepackage{subfiles}

% Custom definition of theorem-like environments.
%% Theorem styles for numbered theorem-like environments.
\newtheoremstyle{Theorem}{5pt plus 2.5pt minus 2.5pt}{5pt plus 2.5pt minus 2.5pt}{\itshape}{}{\bfseries}{.}{\newline}{\thmname{#1} \thmnumber{#2}}
\newtheoremstyle{Plain}{5pt plus 2.5pt minus 2.5pt}{5pt plus 2.5pt minus 2.5pt}{}{}{\bfseries}{.}{\newline}{\thmname{#1} \thmnumber{#2}}
%% Theorem style for unnumbered theorem-like environments.
\newtheoremstyle{Theorem*}{5pt plus 2.5pt minus 2.5pt}{5pt plus 2.5pt minus 2.5pt}{\itshape}{}{\bfseries}{.}{\newline}{\thmname{#1} \thmnote{#3}}
\newtheoremstyle{Plain*}{5pt plus 2.5pt minus 2.5pt}{5pt plus 2.5pt minus 2.5pt}{}{}{\bfseries}{:}{5pt}{\thmname{#1}}
\newtheoremstyle{Proof*}{5pt plus 2.5pt minus 2.5pt}{5pt plus 2.5pt minus 2.5pt}{}{}{\bfseries\itshape}{:}{5pt}{\thmname{#1}}

%% Numberend theorem-like environments
\theoremstyle{Theorem}
\newtheorem{Corollary}{Corollario}[section]
\newtheorem{Theorem}{Teorema}[section]
\newtheorem{Lemma}{Lemma}[section]

\theoremstyle{Plain}
\newtheorem{Proposition}{Proposizione}[section]
\newtheorem{Axiom}{Assioma}[section]

%% Unnumbered theorem-like environments
\theoremstyle{Theorem*}
\newtheorem*{Algorithm*}{Algoritmo}
\newtheorem*{Principle*}{Principio}
\newtheorem*{Postulate*}{Postulato}
\newtheorem*{Theorem*}{Teorema}
\newtheorem*{Axiom*}{Assioma}
\newtheorem*{Law*}{Legge}

\theoremstyle{Plain*}
\newtheorem*{CounterExample*}{Contro Esempio}
\newtheorem*{Definition*}{Definizione}
\newtheorem*{Remark*}{Osservazione}
\newtheorem*{Example*}{Esempio}
\newtheorem*{Note*}{Nota}

\theoremstyle{Proof*}
\newtheorem*{Proof*}{Dimostrazione}

%% Fixing some environment errors
\AtEndEnvironment{equation}{\label{eq:\theequation}}
\AtEndEnvironment{Proof*}{\qed}
\AtBeginEnvironment{tabular}{\color{black}}
\AtBeginEnvironment{minipage}{\color{black}}

\everydisplay{\color{SkyBlue4}}
\everymath{\color{SkyBlue4}}

\counterwithin{figure}{section}
\captionsetup[subfigure]{labelformat=simple}
\renewcommand\thesubfigure{\alph{subfigure}}

%%Tikz & related
\usetikzlibrary{angles, arrows.meta, quotes, patterns, calc, automata, positioning, decorations.pathmorphing, 3d}
\ctikzset{american, full diodes}
\pgfplotsset{compat=1.18}

%%Lstlisting options
\lstset{
    autogobble = true,
    frame = single,
    mathescape,
    basicstyle = \scriptsize
}

\lstdefinelanguage{RAM}{
    keywords = {LOAD, STORE, READ, WRITE, ADD, SUB, MULT, DIV, JUMP, JZERO, JGTZ, HALT},
    keywordstyle = \bfseries,
    autogobble = false,
}

% Document customization
\pagestyle{fancy}

\renewcommand{\sectionmark}[1]{\markboth{{#1}}{}}
\renewcommand{\footrulewidth}{0.1pt}
\rhead{\leftmark}
\lhead{\bfseries Sezione \thesection}

\fancyfoot[C]{-- {\thepage} --}
\setlength\oddsidemargin{10pt}
\setlength\topmargin{0pt}
\setlength\headheight{15pt}
\setlength\headsep{12.5pt}
\setlength\textheight{643.5pt}
\setlength\textwidth{433pt}
\setlength\marginparwidth{0pt}
\setlength\marginparpush{0pt}
\setlength\headwidth{433pt}

\makeatletter
\g@addto@macro\normalsize{%
    \setlength\abovedisplayskip{12.5pt plus 2.5pt minus 2.5pt}
    \setlength\belowdisplayskip{12.5pt plus 2.5pt minus 2.5pt}
    \setlength\abovedisplayshortskip{7.5pt plus 2.5pt}
    \setlength\belowdisplayshortskip{7.5pt plus 2.5pt}
}
\makeatother

\newcommand\sectionbreak{\clearpage}

\let\oldToC\tableofcontents
\let\oldMaketitle\maketitle

\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{2}

\renewcommand{\tableofcontents}{\pagestyle{plain} \oldToC \clearpage \pagestyle{fancy}}

\let\oldText\text
\renewcommand{\text}[1]{\oldText{ {\color{black} #1} }}

\titleformat{\section}{\normalfont\Large\bfseries}{-- {\thesection} --}{1em}{#1.}
\titleformat{\subsection}{\normalfont\large\bfseries}{-- {\thesubsection} --}{1em}{#1.}
\titleformat{\subsubsection}{\normalfont\normalsize\bfseries}{-- {\thesubsubsection} --}{1em}{#1.}
\titleformat{\paragraph}[hang]{\normalfont\normalsize\bfseries}{-- {\theparagraph} --}{1em}{#1.}

\DeclareMathOperator{\Such}{\, : \,}
\DeclareMathOperator{\Given}{\, \vert \,}
\DeclareMathOperator{\Derivation}{\implies \hspace{-7.5pt}*}
\DeclareMathOperator{\Variance}{Var}
\DeclareMathOperator{\Dd}{d}
\DeclareMathOperator{\BigO}{\mathcal{O}}
\DeclareMathOperator{\Covariance}{\mathit{Cov}}
\DeclareMathOperator{\E}{\mathbb{E}}
\DeclareMathOperator{\Natural}{\mathbb{N}}
\DeclareMathOperator{\Integer}{\mathbb{Z}}
\DeclareMathOperator{\Rational}{\mathbb{Q}}
\DeclareMathOperator{\Real}{\mathbb{R}}
\DeclareMathOperator{\Complex}{\mathbb{C}}
\DeclareMathOperator{\Quarternion}{\mathbb{H}}


\NewDocumentCommand{\Scalar}{m m}{
    \left\langle #1, \, #2 \right\rangle
}

\NewDocumentCommand{\Floor}{m}{
    \left\lfloor #1 \right\rfloor
}

\NewDocumentCommand{\Ceil}{m}{
    \left\lceil #1 \right\rceil
}

\NewDocumentCommand{\Range}{s m m}{
    \IfBooleanTF{#1}{
        \left[#2, \, #3\right]
    }{
        \left(#2, \, #3\right)
    }
}

\NewDocumentCommand{\Set}{s m o}{
    \IfBooleanTF{#1}{
        \left\{#2 \Such \IfValueTF{#3}{#3}{}\right\}
    }{
        \left\{#2\right\}
    }
}

\NewDocumentCommand{\Int}{s m m o o}{
    \IfBooleanTF{#1}{
        \int_{\IfValueTF{#4}{#4}{}}^{\IfValueTF{#5}{#5}{}}{#2 \, \partial \, \!#3}
    }{
        \int_{\IfValueTF{#4}{#4}{}}^{\IfValueTF{#5}{#5}{}}{#2 \, \Dd\!#3}
    }
}

\NewDocumentCommand{\Iint}{s m m o}{
    \IfBooleanTF{#1}{
        \iint\limits_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }{
        \iint_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }
}

\NewDocumentCommand{\Iiint}{s m m o}{
    \IfBooleanTF{#1}{
        \iiint\limits_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }{
        \iiint_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }
}

\NewDocumentCommand{\Oint}{s m m o}{
    \IfBooleanTF{#1}{
        \oint\limits_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }{
        \oint_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }
}

\NewDocumentCommand{\Sum}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \sum\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \sum\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \sum\limits_{#3}^{#4}{#2}
        }{
            \sum\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Prod}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \prod\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \prod\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \prod\limits_{#3}^{#4}{#2}
        }{
            \prod\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Coprod}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \coprod\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \coprod\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \coprod\limits_{#3}^{#4}{#2}
        }{
            \coprod\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Bigcup}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \bigcup\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \bigcup\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \bigcup\limits_{#3}^{#4}{#2}
        }{
            \bigcup\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Bigcap}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \bigcap\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \bigcap\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \bigcap\limits_{#3}^{#4}{#2}
        }{
            \bigcap\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Bigvee}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \bigvee\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \bigvee\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \bigvee\limits_{#3}^{#4}{#2}
        }{
            \bigvee\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Bigwedge}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \bigwedge\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \bigwedge\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \bigwedge\limits_{#3}^{#4}{#2}
        }{
            \bigwedge\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Lim}{s m m m}{
    \IfBooleanTF{#1}{
        \lim\limits_{#2 \to #3}{\left(#4\right)}
    }{
        \lim\limits_{#2 \to #3}{#4}
    }
}

\NewDocumentCommand{\Log}{s m o}{
    \IfBooleanTF{#1}{
        \ln_{\IfValueTF{#3}{#3}{}}{\left(#2\right)}
    }{
        \log_{\IfValueTF{#3}{#3}{}}{\left(#2\right)}
    }
}

\NewDocumentCommand{\Frac}{s m m}{
    \IfBooleanTF{#1}{
        \nicefrac{#2}{#3}
    }{
        \frac{#2}{#3}
    }
}

\NewDocumentCommand{\Eval}{m m o}{
\left. {#1} \right\vert_{#2}^{\IfValueTF{#3}{#3}{}}
}

\NewDocumentCommand{\Derivative}{s m m o}{
    \IfBoolean{#1}{
        \IfValue{#4}{
            \frac{\partial^{#4} \ #2}{\partial \, \! #3}
        }{
            \frac{\partial \ #2}{\partial \, \! #3}
        }
    }{
        \IfValue{#4}{
            \frac{\Dd^{#4} \ #2}{\Dd \, \! #3}
        }{
            \frac{\Dd \ #2}{\Dd \, \! #3}
        }
    }
}

\NewDocumentCommand{\Vector}{s m}{
    \IfBooleanTF{#1}{
        \hat{#2}
    }{
        \overset{\rightarrow}{\textbf{#2}}
    }
}

\NewDocumentCommand{\Gradient}{s m}{
    \IfBooleanTF{#1}{
        \nabla \, #2
    }{
        \nabla \left(#2\right)
    }
}

\NewDocumentCommand{\Laplacian}{s m}{
    \IfBooleanTF{#1}{
        \nabla^{2} \, #2
    }{
        \nabla^{2} \left(#2\right)
    }
}

\NewDocumentCommand{\OrderOf}{m}{
    \BigO \left(#1\right)
}

\NewDocumentCommand{\OmegaOf}{m}{
    \Omega \left(#1\right)
}

\NewDocumentCommand{\ThetaOf}{m}{
    \Theta \left(#1\right)
}

\NewDocumentCommand{\Sin}{s m}{
    \IfBooleanTF{#1}{
        \sin #2
    }{
        \sin \left(#2\right)
    }
}

\NewDocumentCommand{\Cos}{s m}{
    \IfBooleanTF{#1}{
        \cos #2
    }{
        \cos \left(#2\right)
    }
}

\NewDocumentCommand{\Tan}{s m}{
    \IfBooleanTF{#1}{
        \tan #2
    }{
        \tan \left(#2\right)
    }
}


\NewDocumentCommand{\Asin}{s m}{
    \IfBooleanTF{#1}{
        \arcsin #2
    }{
        \arcsin \left(#2\right)
    }
}

\NewDocumentCommand{\Acos}{s m}{
    \IfBooleanTF{#1}{
        \arccos #2
    }{
        \arccos \left(#2\right)
    }
}

\NewDocumentCommand{\Atan}{s m}{
    \IfBooleanTF{#1}{
        \arctan #2
    }{
        \arctan \left(#2\right)
    }
}

\NewDocumentCommand{\Sec}{s m}{
    \IfBooleanTF{#1}{
        \sec #2
    }{
        \sec \left(#2\right)
    }
}

\NewDocumentCommand{\Csc}{s m}{
    \IfBooleanTF{#1}{
        \csc #2
    }{
        \csc \left(#2\right)
    }
}

\NewDocumentCommand{\Min}{m o}{
    \IfValueTF{#2}{
        \min \left\{#1 \Such #2\right\}
    }{
        \min \left\{#1\right\}
    }
}

\NewDocumentCommand{\Max}{m o}{
    \IfValueTF{#2}{
        \max \left\{#1 \Such #2\right\}
    }{
        \max \left\{#1\right\}
    }
}

\NewDocumentCommand{\Prob}{m o}{
    \IfValueTF{#2}{
        \Pr \left(#1 \, \vert \, #2\right)
    }{
        \Pr \left(#1\right)
    }
}

\NewDocumentCommand{\Expected}{s m}{
    \IfBooleanTF{#1}{
        \E \left[#2\right]
    }{
        \E \left(#2\right)
    }
}

\NewDocumentCommand{\Var}{s m}{
    \IfBooleanTF{#1}{
        \Variance \left[#2\right]
    }{
        \Variance \left(#2\right)
    }
}

\NewDocumentCommand{\Cov}{m m}{
    \Covariance \left(#1, \, #2\right)
}

\NewDocumentCommand{\Abs}{m}{
    \left\vert #1 \right\vert
}

\NewDocumentCommand{\Norm}{m O{2}}{
    \left\Vert #1 \right\Vert_{#2}
}

\NewDocumentCommand{\Grammar}{m m >{\SplitList{,}}o}{
    \IfValueTF{#3}{
        #1 \to #2 \ProcessList{#3}{\GrammarRule}
    }{
        #1 \to #2
    }
}

\NewDocumentCommand{\GrammarRule}{m}{
    \Given #1
}