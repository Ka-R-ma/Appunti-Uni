\ProvidesPackage{Common}

%% List of used packages
%%%  Other
\usepackage[usernames, x11names]{xcolor}
\usepackage[hidelinks]{hyperref}
\usepackage[italian]{babel}
\usepackage{subfiles}
%%% Packages for document customization
\usepackage{fancyhdr}
\usepackage[a4paper]{geometry}
\usepackage[explicit, compact]{titlesec}
%%% Packagees related to math
\usepackage[fixamsmath, allowspaces]{mathtools}
\usepackage{amssymb, amsthm, mathdots, mathrsfs, multicol, nicefrac}
%%% Packages related to graphics
\usepackage{tikz, forest, listings, lstautogobble, graphicx, wrapfig, caption, subcaption}

%%-------------------------- Document Customization --------------------------

\renewcommand{\sectionmark}[1]{\markboth{{#1}}{}}
\renewcommand{\footrulewidth}{0.1pt}
\rhead{\leftmark}
\lhead{\bfseries Sezione \thesection}

\fancyfoot[C]{-- {\thepage} --}
\setlength\oddsidemargin{10pt}
\setlength\topmargin{0pt}
\setlength\headheight{15pt}
\setlength\headsep{12.5pt}
\setlength\textheight{643.5pt}
\setlength\textwidth{433pt}
\setlength\marginparwidth{0pt}
\setlength\marginparpush{0pt}
\setlength\headwidth{433pt}

\makeatletter
\g@addto@macro\normalsize{%
    \setlength\abovedisplayskip{7.5 pt}
    \setlength\belowdisplayskip{5 pt plus 2.5pt minus 2.5pt}
    \setlength\abovedisplayshortskip{5pt}
    \setlength\belowdisplayshortskip{5pt}
}
\makeatother

\newcommand\sectionbreak{\clearpage}

\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{2}

\titleformat{\section}{\normalfont\Large\bfseries}{-- {\thesection} --}{1em}{#1.}
\titleformat{\subsection}{\normalfont\large\bfseries}{-- {\thesubsection} --}{1em}{#1.}
\titleformat{\subsubsection}{\normalfont\normalsize\bfseries}{-- {\thesubsubsection} --}{1em}{#1.}
\titleformat{\paragraph}[hang]{\normalfont\normalsize\bfseries}{-- {\theparagraph} --}{1em}{#1.}
%%-----------------------------------------------------------------------------

%%------------------------------- Custom Macros -------------------------------
\DeclareMathOperator{\Such}{\, : \,}
\DeclareMathOperator{\Given}{\, | \,}
\DeclareMathOperator{\Dd}{d}
\DeclareMathOperator{\Natural}{\mathbb{N}}
\DeclareMathOperator{\Integer}{\mathbb{Z}}
\DeclareMathOperator{\Rational}{\mathbb{Q}}
\DeclareMathOperator{\Real}{\mathbb{R}}
\DeclareMathOperator{\Complex}{\mathbb{C}}
\DeclareMathOperator{\Quaternion}{\mathbb{H}}
\DeclareMathOperator{\E}{\mathbb{E}}
\DeclareMathOperator{\Variance}{Var}
\DeclareMathOperator{\Covariance}{Cov}
\DeclareMathOperator{\BigO}{\mathcal{O}}
\DeclareMathOperator{\GrammarDerivation}{\implies\hspace{-7.5pt}*}

\NewDocumentCommand{\InternalProduct}{m m}{
    \left\langle #1, \ #2\right\rangle
}

\NewDocumentCommand{\DotProduct}{m m}{
    {#1} {\bullet} {#2}
}

\NewDocumentCommand{\Floor}{m}{
    \left\lfloor {#1} \right\rfloor
}

\NewDocumentCommand{\Ceil}{m}{
    \left\lceil {#1} \right\rceil
}

\NewDocumentCommand{\Range}{s m m}{
    \IfBooleanTF{#1}{
        \ensuremath{\left[#2, \, #3\right]}
    }{
        \ensuremath{\left(#2, \, #3\right)}
    }
}

\NewDocumentCommand{\Set}{m o}{
    \IfValueTF{#2}{
        \ensuremath{\left\{#1 \Such #2\right\}}
    }{
        \ensuremath{ \left\{#1\right\}}
    }
}

\NewDocumentCommand{\Int}{s m m o o}{
    \IfBooleanTF{#1}{
        \int_{\IfValueTF{#4}{#4}{}}^{\IfValueTF{#5}{#5}{}}{#2 \, \partial \, \!#3}
    }{
        \int_{\IfValueTF{#4}{#4}{}}^{\IfValueTF{#5}{#5}{}}{#2 \, \Dd\!#3}
    }
}

\NewDocumentCommand{\Iint}{s m m o}{
    \IfBooleanTF{#1}{
        \iint\limits_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }{
        \iint_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }
}

\NewDocumentCommand{\Iiint}{s m m o}{
    \IfBooleanTF{#1}{
        \iiint\limits_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }{
        \iiint_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }
}

\NewDocumentCommand{\Oint}{s m m o}{
    \IfBooleanTF{#1}{
        \oint\limits_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }{
        \oint_{\IfValueTF{#4}{#4}{}}{#2 \, \Dd\!#3}
    }
}

\NewDocumentCommand{\Sum}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \sum\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \sum\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \sum\limits_{#3}^{#4}{#2}
        }{
            \sum\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Prod}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \prod\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \prod\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \prod\limits_{#3}^{#4}{#2}
        }{
            \prod\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Coprod}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \coprod\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \coprod\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \coprod\limits_{#3}^{#4}{#2}
        }{
            \coprod\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Bigcup}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \bigcup\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \bigcup\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \bigcup\limits_{#3}^{#4}{#2}
        }{
            \bigcup\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Bigcap}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \bigcap\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \bigcap\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \bigcap\limits_{#3}^{#4}{#2}
        }{
            \bigcap\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Bigvee}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \bigvee\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \bigvee\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \bigvee\limits_{#3}^{#4}{#2}
        }{
            \bigvee\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Bigwedge}{s m m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#4}{
            \bigwedge\limits_{#3}^{#4}{\left(#2\right)}
        }{
            \bigwedge\limits_{#3}{\left(#2\right)}
        }
    }{
        \IfValueTF{#4}{
            \bigwedge\limits_{#3}^{#4}{#2}
        }{
            \bigwedge\limits_{#3}{#2}
        }
    }
}

\NewDocumentCommand{\Lim}{s m m m}{
    \IfBooleanTF{#1}{
        \lim\limits_{#2 \to #3}{\left(#4\right)}
    }{
        \lim\limits_{#2 \to #3}{#4}
    }
}

\NewDocumentCommand{\Log}{s m o}{
    \IfBooleanTF{#1}{
        \ln_{\IfValueTF{#3}{#3}{}}{\left(#2\right)}
    }{
        \log_{\IfValueTF{#3}{#3}{}}{\left(#2\right)}
    }
}

\NewDocumentCommand{\Frac}{s m m}{
    \IfBooleanTF{#1}{
        \ensuremath{\nicefrac{#2}{#3}}
    }{
        \frac{#2}{#3}
    }
}

\NewDocumentCommand{\Eval}{m m o}{
\left. {#1} \right\vert_{#2}^{\IfValueTF{#3}{#3}{}}
}

\NewDocumentCommand{\Derivative}{s m m o}{
    \IfBoolean{#1}{
        \IfValue{#4}{
            \frac{\partial^{#4} \ #2}{\partial \, \! #3}
        }{
            \frac{\partial \ #2}{\partial \, \! #3}
        }
    }{
        \IfValue{#4}{
            \frac{\Dd^{#4} \ #2}{\Dd \, \! #3}
        }{
            \frac{\Dd \ #2}{\Dd \, \! #3}
        }
    }
}


\NewDocumentCommand{\Vector}{s m}{
    \IfBooleanTF{#1}{
        \hat{#2}
    }{
        \overset{\rightarrow}{\textbf{#2}}
    }
}

\NewDocumentCommand{\Gradient}{s m}{
    \IfBooleanTF{#1}{
        \nabla \, #2
    }{
        \nabla \left(#2\right)
    }
}

\NewDocumentCommand{\Laplacian}{s m}{
    \IfBooleanTF{#1}{
        \nabla^{2} \, #2
    }{
        \nabla^{2} \left(#2\right)
    }
}

\NewDocumentCommand{\Sin}{s m}{
    \IfBooleanTF{#1}{
        \sin #2
    }{
        \sin \left(#2\right)
    }
}

\NewDocumentCommand{\Cos}{s m}{
    \IfBooleanTF{#1}{
        \cos #2
    }{
        \cos \left(#2\right)
    }
}

\NewDocumentCommand{\Tan}{s m}{
    \IfBooleanTF{#1}{
        \tan #2
    }{
        \tan \left(#2\right)
    }
}


\NewDocumentCommand{\Asin}{s m}{
    \IfBooleanTF{#1}{
        \arcsin #2
    }{
        \arcsin \left(#2\right)
    }
}

\NewDocumentCommand{\Acos}{s m}{
    \IfBooleanTF{#1}{
        \arccos #2
    }{
        \arccos \left(#2\right)
    }
}

\NewDocumentCommand{\Atan}{s m}{
    \IfBooleanTF{#1}{
        \arctan #2
    }{
        \arctan \left(#2\right)
    }
}

\NewDocumentCommand{\Sec}{s m}{
    \IfBooleanTF{#1}{
        \sec #2
    }{
        \sec \left(#2\right)
    }
}

\NewDocumentCommand{\Csc}{s m}{
    \IfBooleanTF{#1}{
        \csc #2
    }{
        \csc \left(#2\right)
    }
}

\NewDocumentCommand{\Min}{s m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#3}{
            \min\limits_{#3}\Set{#2}
        }{
            \min \Set{#2}
        }
    }{
        \min\Set{#2}{#3}
    }
}

\NewDocumentCommand{\Max}{s m o}{
    \IfBooleanTF{#1}{
        \IfValueTF{#3}{
            \max\limits_{#3}\Set{#2}
        }{
            \max \Set{#2}
        }
    }{
        \max\Set{#2}{#3}
    }
}

\NewDocumentCommand{\Prob}{m o}{
    \IfValueTF{#2}{
        \Pr \left(#1 \Given #2\right)
    }{
        \Pr \left(#1\right)
    }
}

\NewDocumentCommand{\Expected}{s m}{
    \IfBooleanTF{#1}{
        \E \left[#2\right]
    }{
        \E \left(#2\right)
    }
}

\NewDocumentCommand{\Var}{s m}{
    \IfBooleanTF{#1}{
        \Variance \left[#2\right]
    }{
        \Variance \left(#2\right)
    }
}

\NewDocumentCommand{\Cov}{m m}{
    \Covariance \left(#1, \, #2\right)
}

\NewDocumentCommand{\Abs}{m}{
    \left\vert {#1} \right\vert
}

\NewDocumentCommand{\Norm}{m O{2}}{
    \left\Vert {#1} \right\Vert_{#2}
}

\NewDocumentCommand{\OrderOf}{m}{
    \BigO \left(#1\right)
}

\NewDocumentCommand{\OmegaOf}{m}{
    \Omega \left(#1\right)
}

\NewDocumentCommand{\ThetaOf}{m}{
    \Theta \left(#1\right)
}

\NewDocumentCommand{\Grammar}{m m >{\SplitList{,}}o}{
    \IfValueTF{#3}{
        \ensuremath{#1 \to #2 \ProcessList{#3}{\GrammarRule}}
    }{
        \ensuremath{#1 \to #2}
    }
}

\NewDocumentCommand{\GrammarRule}{m}{
    \Given #1
}

\NewDocumentCommand{\Tuple}{m m m o}{
    \IfValueTF{#4}{
        \ensuremath{\left({#1}_{#2}, \ldots, {#1}_{#4}, {#1}_{#4 + 1}, \ldots, {#1}_{#3}\right)}
    }{
        \ensuremath{\left({#1}_{#2}, \ldots, {#1}_{#3}\right)}
    }
}

\NewDocumentCommand{\List}{s m m m}{
    \ensuremath{{#2}_{#3}, \ldots, {#2}_{#4}}
}
%%-----------------------------------------------------------------------------

%%---------------------------- Custom Environments ----------------------------
%%%%-------------------------- Numbered Environments --------------------------
\newtheoremstyle{Emphasised}{\abovedisplayshortskip}{\belowdisplayshortskip}{\itshape}{}{\bfseries}{.}{ }{\thmname{#1}\thmnumber{ #2}}

\theoremstyle{Emphasised}
\newtheorem{Proposition}{Proposizione}
\newtheorem{Theorem}{Teorema}[section]
\newtheorem{Corollary}{Corollario}[Theorem]
\newtheorem{Lemma}{Lemma}[Theorem]

%%%%------------------------ Non Numbered Environments ------------------------
\newtheoremstyle{Definition*}{\abovedisplayshortskip}{\belowdisplayshortskip}{}{}{\bfseries}{:}{ }{\thmname{#1}}

\theoremstyle{Definition*}
\newtheorem{Definition*}{Definizione}
\newtheorem{Example*}{Esempio}
\newtheorem{Axiom*}{Assioma}

\newtheoremstyle{Remark*}{}{}{}{}{\bfseries}{.}{ }{\thmname{#1}}

\theoremstyle{Remark*}
\newtheorem{Remark*}{Osservazione}
\newtheorem{Note*}{Nota}

\newtheoremstyle{Proof*}{\abovedisplayshortskip}{\belowdisplayshortskip}{}{\parindent}{\itshape}{:}{ }{\thmname{#1}}

\theoremstyle{Proof*}
\newtheorem{Proof*}{Dimostrazione}

\newtheoremstyle{Emphasised*}{\abovedisplayshortskip}{\belowdisplayshortskip}{}{}{\bfseries}{.}{ }{\thmname{#1}\thmnote{ #3}}

\theoremstyle{Emphasised*}
\newtheorem{Algorithm*}{Algoritmo}
\newtheorem{Theorem*}{Teorema}
\newtheorem{Law*}{Legge}
%%-----------------------------------------------------------------------------

%%---------------------- Adjusting Existing Environments ----------------------
\AtBeginEnvironment{tabular}{\color{black}}
\AtBeginEnvironment{minipage}{\color{black}}

\AtEndEnvironment{equation}{\label{Eq:\theequation}}
\AtEndEnvironment{Proposition}{\label{Prop:\theProposition}}
\AtEndEnvironment{Theorem}{\label{Thm:\theTheorem}}
\AtEndEnvironment{Corollary}{\label{Corol:\theCorollary}}
\AtEndEnvironment{Lemma}{\label{Lemma:\theLemma}}
\AtEndEnvironment{Proof}{\qed}
\AtEndEnvironment{itemize}{\noindent}
\AtEndEnvironment{enumerate}{\noindent}

\counterwithin{figure}{section}
\renewcommand\thesubfigure{\alph{subfigure}}
%%-----------------------------------------------------------------------------

%%------------------------------- Math settings -------------------------------
\everydisplay{\color{SkyBlue4}}
\everymath{\color{SkyBlue4}}
%%-----------------------------------------------------------------------------

%%-------------------------- Tikz & related settings --------------------------
\usetikzlibrary{angles, arrows.meta, quotes, patterns, calc, automata, positioning, decorations.pathmorphing, 3d}
\lstset{
    autogobble = true,
    frame = single,
    frameround = tttt,
    mathescape,
    basicstyle = \scriptsize,
    linewidth = 0.75\textwidth,
    breaklines = true,
    xleftmargin = \parindent,
    escapeinside={__*}{*__}
}

\lstdefinelanguage{PSEUDO}{
    keywords = {if, then, else, for, do, while, true, false, and, AND, or, OR, not, NOT, xor, XOR},
    keywordstyle = \bfseries
}
%%%----------------------------------------------------------------------------

%%---------------------------- Other customization ----------------------------
\let\oldText\text
\let\oldToC\tableofcontents
\renewcommand{\text}[1]{\oldText{\color{black}{ }#1{ }}}
\renewcommand{\tableofcontents}{\oldToC \clearpage \pagestyle{fancy}}
%%%----------------------------------------------------------------------------